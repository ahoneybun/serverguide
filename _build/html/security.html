

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Security &mdash; Ubuntu Server Guide - 14.04 LTS</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '14.04',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ubuntu Server Guide - 14.04 LTS" href="index.html" />
    <link rel="next" title="Monitoring" href="monitoring.html" />
    <link rel="prev" title="Domain Name Service (DNS)" href="dns.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="monitoring.html" title="Monitoring"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="dns.html" title="Domain Name Service (DNS)"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Ubuntu Server Guide - 14.04 LTS</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="security">
<h1>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h1>
<p>Security should always be considered when installing, deploying, and
using any type of computer system. Although a fresh installation of
Ubuntu is relatively safe for immediate use on the Internet, it is
important to have a balanced understanding of your systems security
posture based on how it will be used after deployment.</p>
<p>This chapter provides an overview of security related topics as they
pertain to Ubuntu DISTRO-REV Server Edition, and outlines simple
measures you may use to protect your server and network from any number
of potential security threats.</p>
</div>
<div class="section" id="user-management">
<h1>User Management<a class="headerlink" href="#user-management" title="Permalink to this headline">¶</a></h1>
<p>User management is a critical part of maintaining a secure system.
Ineffective user and privilege management often lead many systems into
being compromised. Therefore, it is important that you understand how
you can protect your server through simple and effective user account
management techniques.</p>
<div class="section" id="where-is-root">
<h2>Where is root?<a class="headerlink" href="#where-is-root" title="Permalink to this headline">¶</a></h2>
<p>Ubuntu developers made a conscientious decision to disable the
administrative root account by default in all Ubuntu installations. This
does not mean that the root account has been deleted or that it may not
be accessed. It merely has been given a password which matches no
possible encrypted value, therefore may not log in directly by itself.</p>
<p>Instead, users are encouraged to make use of a tool by the name of sudo
to carry out system administrative duties. Sudo allows an authorized
user to temporarily elevate their privileges using their own password
instead of having to know the password belonging to the root account.
This simple yet effective methodology provides accountability for all
user actions, and gives the administrator granular control over which
actions a user can perform with said privileges.</p>
<ul>
<li><p class="first">If for some reason you wish to enable the root account, simply give
it a password:</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Configurations with root passwords are not supported.</p>
</div></blockquote>
<p>Sudo will prompt you for your password, and then ask you to supply a
new password for root as shown below:</p>
</li>
<li><p class="first">To disable the root account password, use the following passwd
syntax:</p>
<p>However, to disable the root account itself, use the following
command:</p>
</li>
<li><p class="first">You should read more on Sudo by checking out it&#8217;s man page:</p>
</li>
</ul>
<p>By default, the initial user created by the Ubuntu installer is a member
of the group &#8220;<em>sudo</em>&#8221; which is added to the file <tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> as
an authorized sudo user. If you wish to give any other account full root
access through sudo, simply add them to the <em>sudo</em> group.</p>
</div>
<div class="section" id="adding-and-deleting-users">
<h2>Adding and Deleting Users<a class="headerlink" href="#adding-and-deleting-users" title="Permalink to this headline">¶</a></h2>
<p>The process for managing local users and groups is straight forward and
differs very little from most other GNU/Linux operating systems. Ubuntu
and other Debian based distributions, encourage the use of the &#8220;adduser&#8221;
package for account management.</p>
<ul>
<li><p class="first">To add a user account, use the following syntax, and follow the
prompts to give the account a password and identifiable
characteristics such as a full name, phone number, etc.</p>
</li>
<li><p class="first">To delete a user account and its primary group, use the following
syntax:</p>
<p>Deleting an account does not remove their respective home folder. It
is up to you whether or not you wish to delete the folder manually or
keep it according to your desired retention policies.</p>
<p>Remember, any user added later on with the same UID/GID as the
previous owner will now have access to this folder if you have not
taken the necessary precautions.</p>
<p>You may want to change these UID/GID values to something more
appropriate, such as the root account, and perhaps even relocate the
folder to avoid future conflicts:</p>
</li>
<li><p class="first">To temporarily lock or unlock a user account, use the following
syntax, respectively:</p>
</li>
<li><p class="first">To add or delete a personalized group, use the following syntax,
respectively:</p>
</li>
<li><p class="first">To add a user to a group, use the following syntax:</p>
</li>
</ul>
</div>
<div class="section" id="user-profile-security">
<h2>User Profile Security<a class="headerlink" href="#user-profile-security" title="Permalink to this headline">¶</a></h2>
<p>When a new user is created, the adduser utility creates a brand new home
directory named <tt class="docutils literal"><span class="pre">/home/username</span></tt>, respectively. The default profile is
modeled after the contents found in the directory of <tt class="docutils literal"><span class="pre">/etc/skel</span></tt>,
which includes all profile basics.</p>
<p>If your server will be home to multiple users, you should pay close
attention to the user home directory permissions to ensure
confidentiality. By default, user home directories in Ubuntu are created
with world read/execute permissions. This means that all users can
browse and access the contents of other users home directories. This may
not be suitable for your environment.</p>
<ul>
<li><p class="first">To verify your current users home directory permissions, use the
following syntax:</p>
<p>The following output shows that the directory <tt class="docutils literal"><span class="pre">/home/username</span></tt> has
world readable permissions:</p>
</li>
<li><p class="first">You can remove the world readable permissions using the following
syntax:</p>
<div class="highlight-python"><pre>**Note**

Some people tend to use the recursive option (-R)
indiscriminately which modifies all child folders and files, but
this is not necessary, and may yield other undesirable results.
The parent directory alone is sufficient for preventing
unauthorized access to anything below the parent.</pre>
</div>
<p>A much more efficient approach to the matter would be to modify the
adduser global default permissions when creating user home folders.
Simply edit the file <tt class="docutils literal"><span class="pre">/etc/adduser.conf</span></tt> and modify the
<tt class="docutils literal"><span class="pre">DIR_MODE</span></tt> variable to something appropriate, so that all new home
directories will receive the correct permissions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DIR_MODE</span><span class="o">=</span><span class="mo">0750</span>
</pre></div>
</div>
</li>
<li><p class="first">After correcting the directory permissions using any of the
previously mentioned techniques, verify the results using the
following syntax:</p>
<p>The results below show that world readable permissions have been
removed:</p>
</li>
</ul>
</div>
<div class="section" id="password-policy">
<h2>Password Policy<a class="headerlink" href="#password-policy" title="Permalink to this headline">¶</a></h2>
<p>A strong password policy is one of the most important aspects of your
security posture. Many successful security breaches involve simple brute
force and dictionary attacks against weak passwords. If you intend to
offer any form of remote access involving your local password system,
make sure you adequately address minimum password complexity
requirements, maximum password lifetimes, and frequent audits of your
authentication systems.</p>
<div class="section" id="minimum-password-length">
<h3>Minimum Password Length<a class="headerlink" href="#minimum-password-length" title="Permalink to this headline">¶</a></h3>
<p>By default, Ubuntu requires a minimum password length of 6 characters,
as well as some basic entropy checks. These values are controlled in the
file <tt class="docutils literal"><span class="pre">/etc/pam.d/common-password</span></tt>, which is outlined below.</p>
<div class="highlight-python"><pre>password        [success=1 default=ignore]      pam_unix.so obscure sha512</pre>
</div>
<p>If you would like to adjust the minimum length to 8 characters, change
the appropriate variable to min=8. The modification is outlined below.</p>
<div class="highlight-python"><pre>password        [success=1 default=ignore]      pam_unix.so obscure sha512 minlen=8

**Note**

Basic password entropy checks and minimum length rules do not apply
to the administrator using sudo level commands to setup a new user.</pre>
</div>
</div>
<div class="section" id="password-expiration">
<h3>Password Expiration<a class="headerlink" href="#password-expiration" title="Permalink to this headline">¶</a></h3>
<p>When creating user accounts, you should make it a policy to have a
minimum and maximum password age forcing users to change their passwords
when they expire.</p>
<ul>
<li><p class="first">To easily view the current status of a user account, use the
following syntax:</p>
<p>The output below shows interesting facts about the user account,
namely that there are no policies applied:</p>
</li>
<li><p class="first">To set any of these values, simply use the following syntax, and
follow the interactive prompts:</p>
<p>The following is also an example of how you can manually change the
explicit expiration date (-E) to 01/31/2008, minimum password age
(-m) of 5 days, maximum password age (-M) of 90 days, inactivity
period (-I) of 5 days after password expiration, and a warning time
period (-W) of 14 days before password expiration.</p>
</li>
<li><p class="first">To verify changes, use the same syntax as mentioned previously:</p>
<p>The output below shows the new policies that have been established
for the account:</p>
</li>
</ul>
</div>
</div>
<div class="section" id="other-security-considerations">
<h2>Other Security Considerations<a class="headerlink" href="#other-security-considerations" title="Permalink to this headline">¶</a></h2>
<p>Many applications use alternate authentication mechanisms that can be
easily overlooked by even experienced system administrators. Therefore,
it is important to understand and control how users authenticate and
gain access to services and applications on your server.</p>
<div class="section" id="ssh-access-by-disabled-users">
<h3>SSH Access by Disabled Users<a class="headerlink" href="#ssh-access-by-disabled-users" title="Permalink to this headline">¶</a></h3>
<p>Simply disabling/locking a user account will not prevent a user from
logging into your server remotely if they have previously set up RSA
public key authentication. They will still be able to gain shell access
to the server, without the need for any password. Remember to check the
users home directory for files that will allow for this type of
authenticated SSH access. e.g. <tt class="docutils literal"><span class="pre">/home/username/.ssh/authorized_keys</span></tt>.</p>
<p>Remove or rename the directory <tt class="docutils literal"><span class="pre">.ssh/</span></tt> in the user&#8217;s home folder to
prevent further SSH authentication capabilities.</p>
<p>Be sure to check for any established SSH connections by the disabled
user, as it is possible they may have existing inbound or outbound
connections. Kill any that are found.</p>
<div class="highlight-python"><pre>(to get the pts/# terminal)</pre>
</div>
<p>Restrict SSH access to only user accounts that should have it. For
example, you may create a group called &#8220;sshlogin&#8221; and add the group name
as the value associated with the <tt class="docutils literal"><span class="pre">AllowGroups</span></tt> variable located in the
file <tt class="docutils literal"><span class="pre">/etc/ssh/sshd_config</span></tt>.</p>
<div class="highlight-python"><pre>AllowGroups sshlogin</pre>
</div>
<p>Then add your permitted SSH users to the group &#8220;sshlogin&#8221;, and restart
the SSH service.</p>
</div>
<div class="section" id="external-user-database-authentication">
<h3>External User Database Authentication<a class="headerlink" href="#external-user-database-authentication" title="Permalink to this headline">¶</a></h3>
<p>Most enterprise networks require centralized authentication and access
controls for all system resources. If you have configured your server to
authenticate users against external databases, be sure to disable the
user accounts both externally and locally, this way you ensure that
local fallback authentication is not possible.</p>
</div>
</div>
</div>
<div class="section" id="console-security">
<h1>Console Security<a class="headerlink" href="#console-security" title="Permalink to this headline">¶</a></h1>
<p>As with any other security barrier you put in place to protect your
server, it is pretty tough to defend against untold damage caused by
someone with physical access to your environment, for example, theft of
hard drives, power or service disruption, and so on. Therefore, console
security should be addressed merely as one component of your overall
physical security strategy. A locked &#8220;screen door&#8221; may deter a casual
criminal, or at the very least slow down a determined one, so it is
still advisable to perform basic precautions with regard to console
security.</p>
<p>The following instructions will help defend your server against issues
that could otherwise yield very serious consequences.</p>
<div class="section" id="disable-ctrl-alt-delete">
<h2>Disable Ctrl+Alt+Delete<a class="headerlink" href="#disable-ctrl-alt-delete" title="Permalink to this headline">¶</a></h2>
<p>First and foremost, anyone that has physical access to the keyboard can
simply use the CtrlAltDelete key combination to reboot the server
without having to log on. Sure, someone could simply unplug the power
source, but you should still prevent the use of this key combination on
a production server. This forces an attacker to take more drastic
measures to reboot the server, and will prevent accidental reboots at
the same time.</p>
<ul>
<li><p class="first">To disable the reboot action taken by pressing the CtrlAltDelete key
combination, comment out the following line in the file
<tt class="docutils literal"><span class="pre">/etc/init/control-alt-delete.conf</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#exec shutdown -r now &quot;Control-Alt-Delete pressed&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="firewall">
<h1>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Linux kernel includes the <em>Netfilter</em> subsystem, which is used to
manipulate or decide the fate of network traffic headed into or through
your server. All modern Linux firewall solutions use this system for
packet filtering.</p>
<p>The kernel&#8217;s packet filtering system would be of little use to
administrators without a userspace interface to manage it. This is the
purpose of iptables. When a packet reaches your server, it will be
handed off to the Netfilter subsystem for acceptance, manipulation, or
rejection based on the rules supplied to it from userspace via iptables.
Thus, iptables is all you need to manage your firewall if you&#8217;re
familiar with it, but many frontends are available to simplify the task.</p>
</div>
<div class="section" id="ufw-uncomplicated-firewall">
<h2>ufw - Uncomplicated Firewall<a class="headerlink" href="#ufw-uncomplicated-firewall" title="Permalink to this headline">¶</a></h2>
<p>The default firewall configuration tool for Ubuntu is ufw. Developed to
ease iptables firewall configuration, ufw provides a user friendly way
to create an IPv4 or IPv6 host-based firewall.</p>
<p>ufw by default is initially disabled. From the ufw man page:</p>
<p>“ufw is not intended to provide complete firewall functionality via its
command interface, but instead provides an easy way to add or remove
simple rules. It is currently mainly used for host-based firewalls.”</p>
<p>The following are some examples of how to use ufw:</p>
<ul>
<li><p class="first">First, ufw needs to be enabled. From a terminal prompt enter:</p>
</li>
<li><p class="first">To open a port (ssh in this example):</p>
</li>
<li><p class="first">Rules can also be added using a <em>numbered</em> format:</p>
</li>
<li><p class="first">Similarly, to close an opened port:</p>
</li>
<li><p class="first">To remove a rule, use delete followed by the rule:</p>
</li>
<li><p class="first">It is also possible to allow access from specific hosts or networks
to a port. The following example allows ssh access from host
192.168.0.2 to any ip address on this host:</p>
<p>Replace 192.168.0.2 with 192.168.0.0/24 to allow ssh access from the
entire subnet.</p>
</li>
<li><p class="first">Adding the <em>&#8211;dry-run</em> option to a <em>ufw</em> command will output the
resulting rules, but not apply them. For example, the following is
what would be applied if opening the HTTP port:</p>
<div class="highlight-python"><pre>::</pre>
</div>
</li>
<li><p class="first">ufw can be disabled by:</p>
</li>
<li><p class="first">To see the firewall status, enter:</p>
</li>
<li><p class="first">And for more verbose status information use:</p>
</li>
<li><p class="first">To view the <em>numbered</em> format:</p>
<div class="highlight-python"><pre>**Note**

If the port you want to open or close is defined in
``/etc/services``, you can use the port name instead of the number.
In the above examples, replace *22* with *ssh*.</pre>
</div>
</li>
</ul>
<p>This is a quick introduction to using ufw. Please refer to the ufw man
page for more information.</p>
<div class="section" id="ufw-application-integration">
<h3>ufw Application Integration<a class="headerlink" href="#ufw-application-integration" title="Permalink to this headline">¶</a></h3>
<p>Applications that open ports can include an ufw profile, which details
the ports needed for the application to function properly. The profiles
are kept in <tt class="docutils literal"><span class="pre">/etc/ufw/applications.d</span></tt>, and can be edited if the
default ports have been changed.</p>
<ul>
<li><p class="first">To view which applications have installed a profile, enter the
following in a terminal:</p>
</li>
<li><p class="first">Similar to allowing traffic to a port, using an application profile
is accomplished by entering:</p>
</li>
<li><p class="first">An extended syntax is available as well:</p>
<p>Replace <em>Samba</em> and <em>192.168.0.0/24</em> with the application profile you
are using and the IP range for your network.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>There is no need to specify the <em>protocol</em> for the application,
because that information is detailed in the profile. Also, note
that the <em>app</em> name replaces the <em>port</em> number.</p>
</div></blockquote>
</li>
<li><p class="first">To view details about which ports, protocols, etc are defined for an
application, enter:</p>
</li>
</ul>
<p>Not all applications that require opening a network port come with ufw
profiles, but if you have profiled an application and want the file to
be included with the package, please file a bug against the package in
Launchpad.</p>
</div>
</div>
<div class="section" id="ip-masquerading">
<h2>IP Masquerading<a class="headerlink" href="#ip-masquerading" title="Permalink to this headline">¶</a></h2>
<p>The purpose of IP Masquerading is to allow machines with private,
non-routable IP addresses on your network to access the Internet through
the machine doing the masquerading. Traffic from your private network
destined for the Internet must be manipulated for replies to be routable
back to the machine that made the request. To do this, the kernel must
modify the <em>source</em> IP address of each packet so that replies will be
routed back to it, rather than to the private IP address that made the
request, which is impossible over the Internet. Linux uses <em>Connection
Tracking</em> (conntrack) to keep track of which connections belong to which
machines and reroute each return packet accordingly. Traffic leaving
your private network is thus &#8220;masqueraded&#8221; as having originated from
your Ubuntu gateway machine. This process is referred to in Microsoft
documentation as Internet Connection Sharing.</p>
<div class="section" id="ufw-masquerading">
<h3>ufw Masquerading<a class="headerlink" href="#ufw-masquerading" title="Permalink to this headline">¶</a></h3>
<p>IP Masquerading can be achieved using custom ufw rules. This is possible
because the current back-end for ufw is iptables-restore with the rules
files located in <tt class="docutils literal"><span class="pre">/etc/ufw/*.rules</span></tt>. These files are a great place to
add legacy iptables rules used without ufw, and rules that are more
network gateway or bridge related.</p>
<p>The rules are split into two different files, rules that should be
executed before ufw command line rules, and rules that are executed
after ufw command line rules.</p>
<ul>
<li><p class="first">First, packet forwarding needs to be enabled in ufw. Two
configuration files will need to be adjusted, in <tt class="docutils literal"><span class="pre">/etc/default/ufw</span></tt>
change the <em>DEFAULT_FORWARD_POLICY</em> to “ACCEPT”:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DEFAULT_FORWARD_POLICY</span><span class="o">=</span><span class="s">&quot;ACCEPT&quot;</span>
</pre></div>
</div>
<p>Then edit <tt class="docutils literal"><span class="pre">/etc/ufw/sysctl.conf</span></tt> and uncomment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">ip_forward</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>Similarly, for IPv6 forwarding uncomment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">net</span><span class="o">/</span><span class="n">ipv6</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">forwarding</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Now we will add rules to the <tt class="docutils literal"><span class="pre">/etc/ufw/before.rules</span></tt> file. The
default rules only configure the <em>filter</em> table, and to enable
masquerading the <em>nat</em> table will need to be configured. Add the
following to the top of the file just after the header comments:</p>
<div class="highlight-python"><pre># nat Table rules
*nat
:POSTROUTING ACCEPT [0:0]

# Forward traffic from eth1 through eth0.
-A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE

# don't delete the 'COMMIT' line or these nat table rules won't be processed
COMMIT</pre>
</div>
<p>The comments are not strictly necessary, but it is considered good
practice to document your configuration. Also, when modifying any of
the <em>rules</em> files in <tt class="docutils literal"><span class="pre">/etc/ufw</span></tt>, make sure these lines are the last
line for each table modified:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># don&#39;t delete the &#39;COMMIT&#39; line or these rules won&#39;t be processed</span>
<span class="n">COMMIT</span>
</pre></div>
</div>
<p>For each <em>Table</em> a corresponding <em>COMMIT</em> statement is required. In
these examples only the <em>nat</em> and <em>filter</em> tables are shown, but you
can also add rules for the <em>raw</em> and <em>mangle</em> tables.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>In the above example replace <em>eth0</em>, <em>eth1</em>, and <em>192.168.0.0/24</em>
with the appropriate interfaces and IP range for your network.</p>
</div></blockquote>
</li>
<li><p class="first">Finally, disable and re-enable ufw to apply the changes:</p>
</li>
</ul>
<p>IP Masquerading should now be enabled. You can also add any additional
FORWARD rules to the <tt class="docutils literal"><span class="pre">/etc/ufw/before.rules</span></tt>. It is recommended that
these additional rules be added to the <em>ufw-before-forward</em> chain.</p>
</div>
<div class="section" id="iptables-masquerading">
<h3>iptables Masquerading<a class="headerlink" href="#iptables-masquerading" title="Permalink to this headline">¶</a></h3>
<p>iptables can also be used to enable Masquerading.</p>
<ul>
<li><p class="first">Similar to ufw, the first step is to enable IPv4 packet forwarding by
editing <tt class="docutils literal"><span class="pre">/etc/sysctl.conf</span></tt> and uncomment the following line</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>If you wish to enable IPv6 forwarding also uncomment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">net</span><span class="o">.</span><span class="n">ipv6</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">forwarding</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Next, execute the sysctl command to enable the new settings in the
configuration file:</p>
</li>
<li><p class="first">IP Masquerading can now be accomplished with a single iptables rule,
which may differ slightly based on your network configuration:</p>
<div class="highlight-python"><pre>sudo iptables -t nat -A POSTROUTING -s 192.168.0.0/16 -o ppp0 -j MASQUERADE</pre>
</div>
<p>The above command assumes that your private address space is
192.168.0.0/16 and that your Internet-facing device is ppp0. The
syntax is broken down as follows:</p>
<ul class="simple">
<li>-t nat &#8211; the rule is to go into the nat table</li>
<li>-A POSTROUTING &#8211; the rule is to be appended (-A) to the
POSTROUTING chain</li>
<li>-s 192.168.0.0/16 &#8211; the rule applies to traffic originating from
the specified address space</li>
<li>-o ppp0 &#8211; the rule applies to traffic scheduled to be routed
through the specified network device</li>
<li>-j MASQUERADE &#8211; traffic matching this rule is to &#8220;jump&#8221; (-j) to
the MASQUERADE target to be manipulated as described above</li>
</ul>
</li>
<li><p class="first">Also, each chain in the filter table (the default table, and where
most or all packet filtering occurs) has a default <em>policy</em> of
ACCEPT, but if you are creating a firewall in addition to a gateway
device, you may have set the policies to DROP or REJECT, in which
case your masqueraded traffic needs to be allowed through the FORWARD
chain for the above rule to work:</p>
<div class="highlight-python"><pre>sudo iptables -A FORWARD -s 192.168.0.0/16 -o ppp0 -j ACCEPT
sudo iptables -A FORWARD -d 192.168.0.0/16 -m state \
--state ESTABLISHED,RELATED -i ppp0 -j ACCEPT</pre>
</div>
<p>The above commands will allow all connections from your local network
to the Internet and all traffic related to those connections to
return to the machine that initiated them.</p>
</li>
<li><p class="first">If you want masquerading to be enabled on reboot, which you probably
do, edit <tt class="docutils literal"><span class="pre">/etc/rc.local</span></tt> and add any commands used above. For
example add the first command with no filtering:</p>
<div class="highlight-python"><pre>iptables -t nat -A POSTROUTING -s 192.168.0.0/16 -o ppp0 -j MASQUERADE</pre>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="logs">
<h2>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h2>
<p>Firewall logs are essential for recognizing attacks, troubleshooting
your firewall rules, and noticing unusual activity on your network. You
must include logging rules in your firewall for them to be generated,
though, and logging rules must come before any applicable terminating
rule (a rule with a target that decides the fate of the packet, such as
ACCEPT, DROP, or REJECT).</p>
<p>If you are using ufw, you can turn on logging by entering the following
in a terminal:</p>
<p>To turn logging off in ufw, simply replace <em>on</em> with <em>off</em> in the above
command.</p>
<p>If using iptables instead of ufw, enter:</p>
<div class="highlight-python"><pre>sudo iptables -A INPUT -m state --state NEW -p tcp --dport 80 \
-j LOG --log-prefix "NEW_HTTP_CONN: "</pre>
</div>
<p>A request on port 80 from the local machine, then, would generate a log
in dmesg that looks like this (single line split into 3 to fit this
document):</p>
<div class="highlight-python"><pre>[4304885.870000] NEW_HTTP_CONN: IN=lo OUT= MAC=00:00:00:00:00:00:00:00:00:00:00:00:08:00
SRC=127.0.0.1 DST=127.0.0.1 LEN=60 TOS=0x00 PREC=0x00 TTL=64 ID=58288 DF PROTO=TCP
SPT=53981 DPT=80 WINDOW=32767 RES=0x00 SYN URGP=0</pre>
</div>
<p>The above log will also appear in <tt class="docutils literal"><span class="pre">/var/log/messages</span></tt>,
<tt class="docutils literal"><span class="pre">/var/log/syslog</span></tt>, and <tt class="docutils literal"><span class="pre">/var/log/kern.log</span></tt>. This behavior can be
modified by editing <tt class="docutils literal"><span class="pre">/etc/syslog.conf</span></tt> appropriately or by installing
and configuring ulogd and using the ULOG target instead of LOG. The
ulogd daemon is a userspace server that listens for logging instructions
from the kernel specifically for firewalls, and can log to any file you
like, or even to a PostgreSQL or MySQL database. Making sense of your
firewall logs can be simplified by using a log analyzing tool such as
logwatch, fwanalog, fwlogwatch, or lire.</p>
</div>
<div class="section" id="other-tools">
<h2>Other Tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h2>
<p>There are many tools available to help you construct a complete firewall
without intimate knowledge of iptables. For the GUI-inclined:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.fwbuilder.org/">fwbuilder</a> is very powerful and will
look familiar to an administrator who has used a commercial firewall
utility such as Checkpoint FireWall-1.</li>
</ul>
<p>If you prefer a command-line tool with plain-text configuration files:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.shorewall.net/">Shorewall</a> is a very powerful solution
to help you configure an advanced firewall for any network.</li>
</ul>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The <a class="reference external" href="https://wiki.ubuntu.com/UncomplicatedFirewall">Ubuntu
Firewall</a> wiki page
contains information on the development of ufw.</li>
<li>Also, the ufw manual page contains some very useful information:
<tt class="docutils literal"><span class="pre">man</span> <span class="pre">ufw</span></tt>.</li>
<li>See the
<a class="reference external" href="http://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO.html">packet-filtering-HOWTO</a>
for more information on using iptables.</li>
<li>The
<a class="reference external" href="http://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html">nat-HOWTO</a>
contains further details on masquerading.</li>
<li>The <a class="reference external" href="https://help.ubuntu.com/community/IptablesHowTo">IPTables
HowTo</a> in the
Ubuntu wiki is a great resource.</li>
</ul>
</div>
</div>
<div class="section" id="apparmor">
<h1>AppArmor<a class="headerlink" href="#apparmor" title="Permalink to this headline">¶</a></h1>
<p>AppArmor is a Linux Security Module implementation of name-based
mandatory access controls. AppArmor confines individual programs to a
set of listed files and posix 1003.1e draft capabilities.</p>
<p>AppArmor is installed and loaded by default. It uses <em>profiles</em> of an
application to determine what files and permissions the application
requires. Some packages will install their own profiles, and additional
profiles can be found in the apparmor-profiles package.</p>
<p>To install the apparmor-profiles package from a terminal prompt:</p>
<p>AppArmor profiles have two modes of execution:</p>
<ul class="simple">
<li>Complaining/Learning: profile violations are permitted and logged.
Useful for testing and developing new profiles.</li>
<li>Enforced/Confined: enforces profile policy as well as logging the
violation.</li>
</ul>
<div class="section" id="using-apparmor">
<h2>Using AppArmor<a class="headerlink" href="#using-apparmor" title="Permalink to this headline">¶</a></h2>
<p>The apparmor-utils package contains command line utilities that you can
use to change the AppArmor execution mode, find the status of a profile,
create new profiles, etc.</p>
<ul>
<li><p class="first">apparmor_status is used to view the current status of AppArmor
profiles.</p>
</li>
<li><p class="first">aa-complain places a profile into <em>complain</em> mode.</p>
</li>
<li><p class="first">aa-enforce places a profile into <em>enforce</em> mode.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">/etc/apparmor.d</span></tt> directory is where the AppArmor profiles are
located. It can be used to manipulate the <em>mode</em> of all profiles.</p>
<p>Enter the following to place all profiles into complain mode:</p>
<p>To place all profiles in enforce mode:</p>
</li>
<li><p class="first">apparmor_parser is used to load a profile into the kernel. It can
also be used to reload a currently loaded profile using the <em>-r</em>
option. To load a profile:</p>
<p>To reload a profile:</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">service</span> <span class="pre">apparmor</span></tt> can be used to <em>reload</em> all profiles:</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">/etc/apparmor.d/disable</span></tt> directory can be used along with the
apparmor_parser -R option to <em>disable</em> a profile.</p>
<p>To <em>re-enable</em> a disabled profile remove the symbolic link to the
profile in <tt class="docutils literal"><span class="pre">/etc/apparmor.d/disable/</span></tt>. Then load the profile using
the <em>-a</em> option.</p>
</li>
<li><p class="first">AppArmor can be disabled, and the kernel module unloaded by entering
the following:</p>
</li>
<li><p class="first">To re-enable AppArmor enter:</p>
<div class="highlight-python"><pre>**Note**

Replace *profile.name* with the name of the profile you want to
manipulate. Also, replace ``/path/to/bin/`` with the actual
executable file path. For example for the ping command use
``/bin/ping``</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="profiles">
<h2>Profiles<a class="headerlink" href="#profiles" title="Permalink to this headline">¶</a></h2>
<p>AppArmor profiles are simple text files located in <tt class="docutils literal"><span class="pre">/etc/apparmor.d/</span></tt>.
The files are named after the full path to the executable they profile
replacing the &#8220;/&#8221; with &#8221;.&#8221;. For example <tt class="docutils literal"><span class="pre">/etc/apparmor.d/bin.ping</span></tt> is
the AppArmor profile for the <tt class="docutils literal"><span class="pre">/bin/ping</span></tt> command.</p>
<p>There are two main type of rules used in profiles:</p>
<ul class="simple">
<li><em>Path entries:</em> which detail which files an application can access in
the file system.</li>
<li><em>Capability entries:</em> determine what privileges a confined process is
allowed to use.</li>
</ul>
<p>As an example take a look at <tt class="docutils literal"><span class="pre">/etc/apparmor.d/bin.ping</span></tt>:</p>
<div class="highlight-python"><pre>#include &lt;tunables/global&gt;
/bin/ping flags=(complain) {
  #include &lt;abstractions/base&gt;
  #include &lt;abstractions/consoles&gt;
  #include &lt;abstractions/nameservice&gt;

  capability net_raw,
  capability setuid,
  network inet raw,

  /bin/ping mixr,
  /etc/modules.conf r,
}</pre>
</div>
<ul>
<li><p class="first"><em>#include &lt;tunables/global&gt;:</em> include statements from other files.
This allows statements pertaining to multiple applications to be
placed in a common file.</p>
</li>
<li><p class="first"><em>/bin/ping flags=(complain):</em> path to the profiled program, also
setting the mode to <em>complain</em>.</p>
</li>
<li><p class="first"><em>capability net_raw,:</em> allows the application access to the
CAP_NET_RAW Posix.1e capability.</p>
</li>
<li><p class="first"><em>/bin/ping mixr,:</em> allows the application read and execute access to
the file.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>After editing a profile file the profile must be reloaded. See ? for
details.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="creating-a-profile">
<h3>Creating a Profile<a class="headerlink" href="#creating-a-profile" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><em>Design a test plan:</em> Try to think about how the application should
be exercised. The test plan should be divided into small test cases.
Each test case should have a small description and list the steps to
follow.</p>
<p>Some standard test cases are:</p>
<ul class="simple">
<li>Starting the program.</li>
<li>Stopping the program.</li>
<li>Reloading the program.</li>
<li>Testing all the commands supported by the init script.</li>
</ul>
</li>
<li><p class="first"><em>Generate the new profile:</em> Use aa-genprof to generate a new profile.
From a terminal:</p>
<p>For example:</p>
</li>
<li><p class="first">To get your new profile included in the apparmor-profiles package,
file a bug in <em>Launchpad</em> against the
<a class="reference external" href="https://bugs.launchpad.net/ubuntu/+source/apparmor/+filebug">AppArmor</a>
package:</p>
<ul class="simple">
<li>Include your test plan and test cases.</li>
<li>Attach your new profile to the bug.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="updating-profiles">
<h3>Updating Profiles<a class="headerlink" href="#updating-profiles" title="Permalink to this headline">¶</a></h3>
<p>When the program is misbehaving, audit messages are sent to the log
files. The program aa-logprof can be used to scan log files for AppArmor
audit messages, review them and update the profiles. From a terminal:</p>
</div>
</div>
<div class="section" id="id1">
<h2>References<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>See the <a class="reference external" href="http://www.novell.com/documentation/apparmor/apparmor201_sp10_admin/index.html?page=/documentation/apparmor/apparmor201_sp10_admin/data/book_apparmor_admin.html">AppArmor Administration
Guide</a>
for advanced configuration options.</li>
<li>For details using AppArmor with other Ubuntu releases see the
<a class="reference external" href="https://help.ubuntu.com/community/AppArmor">AppArmor Community
Wiki</a> page.</li>
<li>The <a class="reference external" href="http://en.opensuse.org/SDB:AppArmor_geeks">OpenSUSE AppArmor</a>
page is another introduction to AppArmor.</li>
<li>A great place to ask for AppArmor assistance, and get involved with
the Ubuntu Server community, is the <em>#ubuntu-server</em> IRC channel on
<a class="reference external" href="http://freenode.net">freenode</a>.</li>
</ul>
</div>
</div>
<div class="section" id="certificates">
<h1>Certificates<a class="headerlink" href="#certificates" title="Permalink to this headline">¶</a></h1>
<p>One of the most common forms of cryptography today is <em>public-key</em>
cryptography. Public-key cryptography utilizes a <em>public key</em> and a
<em>private key</em>. The system works by <em>encrypting</em> information using the
public key. The information can then only be <em>decrypted</em> using the
private key.</p>
<p>A common use for public-key cryptography is encrypting application
traffic using a Secure Socket Layer (SSL) or Transport Layer Security
(TLS) connection. For example, configuring Apache to provide <em>HTTPS</em>,
the HTTP protocol over SSL. This allows a way to encrypt traffic using a
protocol that does not itself provide encryption.</p>
<p>A <em>Certificate</em> is a method used to distribute a <em>public key</em> and other
information about a server and the organization who is responsible for
it. Certificates can be digitally signed by a <em>Certification Authority</em>
or CA. A CA is a trusted third party that has confirmed that the
information contained in the certificate is accurate.</p>
<div class="section" id="types-of-certificates">
<h2>Types of Certificates<a class="headerlink" href="#types-of-certificates" title="Permalink to this headline">¶</a></h2>
<p>To set up a secure server using public-key cryptography, in most cases,
you send your certificate request (including your public key), proof of
your company&#8217;s identity, and payment to a CA. The CA verifies the
certificate request and your identity, and then sends back a certificate
for your secure server. Alternatively, you can create your own
<em>self-signed</em> certificate.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Note, that self-signed certificates should not be used in most
production environments.</p>
</div></blockquote>
<p>Continuing the HTTPS example, a CA-signed certificate provides two
important capabilities that a self-signed certificate does not:</p>
<ul class="simple">
<li>Browsers (usually) automatically recognize the certificate and allow
a secure connection to be made without prompting the user.</li>
<li>When a CA issues a signed certificate, it is guaranteeing the
identity of the organization that is providing the web pages to the
browser.</li>
</ul>
<p>Most Web browsers, and computers, that support SSL have a list of CAs
whose certificates they automatically accept. If a browser encounters a
certificate whose authorizing CA is not in the list, the browser asks
the user to either accept or decline the connection. Also, other
applications may generate an error message when using a self-signed
certificate.</p>
<p>The process of getting a certificate from a CA is fairly easy. A quick
overview is as follows:</p>
<ol class="arabic">
<li><p class="first">Create a private and public encryption key pair.</p>
</li>
<li><p class="first">Create a certificate request based on the public key. The certificate
request contains information about your server and the company
hosting it.</p>
</li>
<li><p class="first">Send the certificate request, along with documents proving your
identity, to a CA. We cannot tell you which certificate authority to
choose. Your decision may be based on your past experiences, or on
the experiences of your friends or colleagues, or purely on monetary
factors.</p>
<p>Once you have decided upon a CA, you need to follow the instructions
they provide on how to obtain a certificate from them.</p>
</li>
<li><p class="first">When the CA is satisfied that you are indeed who you claim to be,
they send you a digital certificate.</p>
</li>
<li><p class="first">Install this certificate on your secure server, and configure the
appropriate applications to use the certificate.</p>
</li>
</ol>
</div>
<div class="section" id="generating-a-certificate-signing-request-csr">
<h2>Generating a Certificate Signing Request (CSR)<a class="headerlink" href="#generating-a-certificate-signing-request-csr" title="Permalink to this headline">¶</a></h2>
<p>Whether you are getting a certificate from a CA or generating your own
self-signed certificate, the first step is to generate a key.</p>
<p>If the certificate will be used by service daemons, such as Apache,
Postfix, Dovecot, etc, a key without a passphrase is often appropriate.
Not having a passphrase allows the services to start without manual
intervention, usually the preferred way to start a daemon.</p>
<p>This section will cover generating a key with a passphrase, and one
without. The non-passphrase key will then be used to generate a
certificate that can be used with various service daemons.</p>
<blockquote>
<div><p><strong>Warning</strong></p>
<p>Running your secure service without a passphrase is convenient
because you will not need to enter the passphrase every time you
start your secure service. But it is insecure and a compromise of
the key means a compromise of the server as well.</p>
</div></blockquote>
<p>To generate the <em>keys</em> for the Certificate Signing Request (CSR) run the
following command from a terminal prompt:</p>
<div class="highlight-python"><pre>::</pre>
</div>
<blockquote>
<div>Generating RSA private key, 2048 bit long modulus
..........................++++++
.......++++++
e is 65537 (0x10001)
Enter pass phrase for server.key:</div></blockquote>
<p>You can now enter your passphrase. For best security, it should at least
contain eight characters. The minimum length when specifying -des3 is
four characters. It should include numbers and/or punctuation and not be
a word in a dictionary. Also remember that your passphrase is
case-sensitive.</p>
<p>Re-type the passphrase to verify. Once you have re-typed it correctly,
the server key is generated and stored in the <tt class="docutils literal"><span class="pre">server.key</span></tt> file.</p>
<p>Now create the insecure key, the one without a passphrase, and shuffle
the key names:</p>
<p>The insecure key is now named <tt class="docutils literal"><span class="pre">server.key</span></tt>, and you can use this file
to generate the CSR without passphrase.</p>
<p>To create the CSR, run the following command at a terminal prompt:</p>
<p>It will prompt you enter the passphrase. If you enter the correct
passphrase, it will prompt you to enter Company Name, Site Name, Email
Id, etc. Once you enter all these details, your CSR will be created and
it will be stored in the <tt class="docutils literal"><span class="pre">server.csr</span></tt> file.</p>
<p>You can now submit this CSR file to a CA for processing. The CA will use
this CSR file and issue the certificate. On the other hand, you can
create self-signed certificate using this CSR.</p>
</div>
<div class="section" id="creating-a-self-signed-certificate">
<h2>Creating a Self-Signed Certificate<a class="headerlink" href="#creating-a-self-signed-certificate" title="Permalink to this headline">¶</a></h2>
<p>To create the self-signed certificate, run the following command at a
terminal prompt:</p>
<p>The above command will prompt you to enter the passphrase. Once you
enter the correct passphrase, your certificate will be created and it
will be stored in the <tt class="docutils literal"><span class="pre">server.crt</span></tt> file.</p>
<blockquote>
<div><p><strong>Warning</strong></p>
<p>If your secure server is to be used in a production environment, you
probably need a CA-signed certificate. It is not recommended to use
self-signed certificate.</p>
</div></blockquote>
</div>
<div class="section" id="installing-the-certificate">
<h2>Installing the Certificate<a class="headerlink" href="#installing-the-certificate" title="Permalink to this headline">¶</a></h2>
<p>You can install the key file <tt class="docutils literal"><span class="pre">server.key</span></tt> and certificate file
<tt class="docutils literal"><span class="pre">server.crt</span></tt>, or the certificate file issued by your CA, by running
following commands at a terminal prompt:</p>
<p>Now simply configure any applications, with the ability to use
public-key cryptography, to use the <em>certificate</em> and <em>key</em> files. For
example, Apache can provide HTTPS, Dovecot can provide IMAPS and POP3S,
etc.</p>
</div>
<div class="section" id="certification-authority">
<h2>Certification Authority<a class="headerlink" href="#certification-authority" title="Permalink to this headline">¶</a></h2>
<p>If the services on your network require more than a few self-signed
certificates it may be worth the additional effort to setup your own
internal <em>Certification Authority (CA)</em>. Using certificates signed by
your own CA, allows the various services using the certificates to
easily trust other services using certificates issued from the same CA.</p>
<p>First, create the directories to hold the CA certificate and related
files:</p>
<p>The CA needs a few additional files to operate, one to keep track of the
last serial number used by the CA, each certificate must have a unique
serial number, and another file to record which certificates have been
issued:</p>
<p>The third file is a CA configuration file. Though not strictly
necessary, it is very convenient when issuing multiple certificates.
Edit <tt class="docutils literal"><span class="pre">/etc/ssl/openssl.cnf</span></tt>, and in the <em>[ CA_default ]</em> change:</p>
<div class="highlight-python"><pre>dir             = /etc/ssl/             # Where everything is kept
database        = $dir/CA/index.txt     # database index file.
certificate     = $dir/certs/cacert.pem # The CA certificate
serial          = $dir/CA/serial        # The current serial number
private_key     = $dir/private/cakey.pem# The private key</pre>
</div>
<p>Next, create the self-signed root certificate:</p>
<p>You will then be asked to enter the details about the certificate.</p>
<p>Now install the root certificate and key:</p>
<p>You are now ready to start signing certificates. The first item needed
is a Certificate Signing Request (CSR), see ? for details. Once you have
a CSR, enter the following to generate a certificate signed by the CA:</p>
<p>After entering the password for the CA key, you will be prompted to sign
the certificate, and again to commit the new certificate. You should
then see a somewhat large amount of output related to the certificate
creation.</p>
<p>There should now be a new file, <tt class="docutils literal"><span class="pre">/etc/ssl/newcerts/01.pem</span></tt>, containing
the same output. Copy and paste everything beginning with the line:
<em>&#8212;&#8211;BEGIN CERTIFICATE&#8212;&#8211;</em> and continuing through the line: <em>&#8212;-END
CERTIFICATE&#8212;&#8211;</em> lines to a file named after the hostname of the server
where the certificate will be installed. For example
<tt class="docutils literal"><span class="pre">mail.example.com.crt</span></tt>, is a nice descriptive name.</p>
<p>Subsequent certificates will be named <tt class="docutils literal"><span class="pre">02.pem</span></tt>, <tt class="docutils literal"><span class="pre">03.pem</span></tt>, etc.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Replace <em>mail.example.com.crt</em> with your own descriptive name.</p>
</div></blockquote>
<p>Finally, copy the new certificate to the host that needs it, and
configure the appropriate applications to use it. The default location
to install certificates is <tt class="docutils literal"><span class="pre">/etc/ssl/certs</span></tt>. This enables multiple
services to use the same certificate without overly complicated file
permissions.</p>
<p>For applications that can be configured to use a CA certificate, you
should also copy the <tt class="docutils literal"><span class="pre">/etc/ssl/certs/cacert.pem</span></tt> file to the
<tt class="docutils literal"><span class="pre">/etc/ssl/certs/</span></tt> directory on each server.</p>
</div>
<div class="section" id="id2">
<h2>References<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>For more detailed instructions on using cryptography see the <a class="reference external" href="http://tldp.org/HOWTO/SSL-Certificates-HOWTO/index.html">SSL
Certificates
HOWTO</a> by
tlpd.org</li>
<li>The Wikipedia <a class="reference external" href="http://en.wikipedia.org/wiki/Https">HTTPS</a> page has
more information regarding HTTPS.</li>
<li>For more information on <em>OpenSSL</em> see the <a class="reference external" href="http://www.openssl.org/">OpenSSL Home
Page</a>.</li>
<li>Also, O&#8217;Reilly&#8217;s <a class="reference external" href="http://oreilly.com/catalog/9780596002701/">Network Security with
OpenSSL</a> is a good in
depth reference.</li>
</ul>
</div>
</div>
<div class="section" id="ecryptfs">
<h1>eCryptfs<a class="headerlink" href="#ecryptfs" title="Permalink to this headline">¶</a></h1>
<p><em>eCryptfs</em> is a POSIX-compliant enterprise-class stacked cryptographic
filesystem for Linux. Layering on top of the filesystem layer <em>eCryptfs</em>
protects files no matter the underlying filesystem, partition type, etc.</p>
<p>During installation there is an option to encrypt the <tt class="docutils literal"><span class="pre">/home</span></tt>
partition. This will automatically configure everything needed to
encrypt and mount the partition.</p>
<p>As an example, this section will cover configuring <tt class="docutils literal"><span class="pre">/srv</span></tt> to be
encrypted using <em>eCryptfs</em>.</p>
<div class="section" id="using-ecryptfs">
<h2>Using eCryptfs<a class="headerlink" href="#using-ecryptfs" title="Permalink to this headline">¶</a></h2>
<p>First, install the necessary packages. From a terminal prompt enter:</p>
<p>Now mount the partition to be encrypted:</p>
<p>You will then be prompted for some details on how ecryptfs should
encrypt the data.</p>
<p>To test that files placed in <tt class="docutils literal"><span class="pre">/srv</span></tt> are indeed encrypted copy the
<tt class="docutils literal"><span class="pre">/etc/default</span></tt> folder to <tt class="docutils literal"><span class="pre">/srv</span></tt>:</p>
<p>Now unmount <tt class="docutils literal"><span class="pre">/srv</span></tt>, and try to view a file:</p>
<p>Remounting <tt class="docutils literal"><span class="pre">/srv</span></tt> using ecryptfs will make the data viewable once
again.</p>
</div>
<div class="section" id="automatically-mounting-encrypted-partitions">
<h2>Automatically Mounting Encrypted Partitions<a class="headerlink" href="#automatically-mounting-encrypted-partitions" title="Permalink to this headline">¶</a></h2>
<p>There are a couple of ways to automatically mount an ecryptfs encrypted
filesystem at boot. This example will use a <tt class="docutils literal"><span class="pre">/root/.ecryptfsrc</span></tt> file
containing mount options, along with a passphrase file residing on a USB
key.</p>
<p>First, create <tt class="docutils literal"><span class="pre">/root/.ecryptfsrc</span></tt> containing:</p>
<div class="highlight-python"><pre>key=passphrase:passphrase_passwd_file=/mnt/usb/passwd_file.txt
ecryptfs_sig=5826dd62cf81c615
ecryptfs_cipher=aes
ecryptfs_key_bytes=16
ecryptfs_passthrough=n
ecryptfs_enable_filename_crypto=n

**Note**

Adjust the *ecryptfs\_sig* to the signature in
``/root/.ecryptfs/sig-cache.txt``.</pre>
</div>
<p>Next, create the <tt class="docutils literal"><span class="pre">/mnt/usb/passwd_file.txt</span></tt> passphrase file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">passphrase_passwd</span><span class="o">=</span><span class="p">[</span><span class="n">secrets</span><span class="p">]</span>
</pre></div>
</div>
<p>Now add the necessary lines to <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt>:</p>
<div class="highlight-python"><pre>/dev/sdb1       /mnt/usb        ext3    ro      0 0
/srv /srv ecryptfs defaults 0 0</pre>
</div>
<p>Make sure the USB drive is mounted before the encrypted partition.</p>
<p>Finally, reboot and the <tt class="docutils literal"><span class="pre">/srv</span></tt> should be mounted using <em>eCryptfs</em>.</p>
</div>
<div class="section" id="other-utilities">
<h2>Other Utilities<a class="headerlink" href="#other-utilities" title="Permalink to this headline">¶</a></h2>
<p>The ecryptfs-utils package includes several other useful utilities:</p>
<ul class="simple">
<li><em>ecryptfs-setup-private:</em> creates a <tt class="docutils literal"><span class="pre">~/Private</span></tt> directory to
contain encrypted information. This utility can be run by
unprivileged users to keep data private from other users on the
system.</li>
<li><em>ecryptfs-mount-private and ecryptfs-umount-private:</em> will mount and
unmount respectively, a users <tt class="docutils literal"><span class="pre">~/Private</span></tt> directory.</li>
<li><em>ecryptfs-add-passphrase:</em> adds a new passphrase to the kernel
keyring.</li>
<li><em>ecryptfs-manager:</em> manages eCryptfs objects such as keys.</li>
<li><em>ecryptfs-stat:</em> allows you to view the ecryptfs meta information for
a file.</li>
</ul>
</div>
<div class="section" id="id3">
<h2>References<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>For more information on <em>eCryptfs</em> see the <a class="reference external" href="https://launchpad.net/ecryptfs">Launchpad project
page</a>.</li>
<li>There is also a <a class="reference external" href="http://www.linuxjournal.com/article/9400">Linux
Journal</a> article
covering <em>eCryptfs</em>.</li>
<li>Also, for more ecryptfs options see the <a class="reference external" href="http://manpages.ubuntu.com/manpages/&amp;distro-short-codename;/en/man7/ecryptfs.7.html">ecryptfs man
page</a>.</li>
<li>The <a class="reference external" href="https://help.ubuntu.com/community/eCryptfs">eCryptfs Ubuntu
Wiki</a> page also has
more details.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/ubuntu_black-orange_hex_su-medium_cropped.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#preparing-to-install">Preparing to Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#installing-from-cd">Installing from CD</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#upgrading">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#advanced-installation">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#kernel-crash-dump">Kernel Crash Dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html">Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#dpkg">dpkg</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#apt-get">Apt-Get</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#aptitude">Aptitude</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#automatic-updates">Automatic Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="package-management.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-config.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-config.html#network-configuration">Network Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-config.html#tcp-ip">TCP/IP</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-config.html#dynamic-host-configuration-protocol-dhcp">Dynamic Host Configuration Protocol (DHCP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-config.html#time-synchronisation-with-ntp">Time Synchronisation with NTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html">DMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html#device-mapper-multipathing">Device Mapper Multipathing</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html#multipath-devices">Multipath Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html#setting-up-dmm-overview">Setting up DMM Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html#the-dmm-configuration-file">The DMM Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipath.html#dmm-administration-and-troubleshooting">DMM Administration and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-administration.html">Remote Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-administration.html#openssh-server">OpenSSH Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-administration.html#puppet">Puppet</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-administration.html#zentyal">Zentyal</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-auth.html">Network Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-auth.html#openldap-server">OpenLDAP Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-auth.html#samba-and-ldap">Samba and LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-auth.html#kerberos">Kerberos</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-auth.html#kerberos-and-ldap">Kerberos and LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html">Domain Name Service (DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html#references">References</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="#user-management">User Management</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#console-security">Console Security</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#firewall">Firewall</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#apparmor">AppArmor</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#certificates">Certificates</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#ecryptfs">eCryptfs</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html#nagios">Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html#munin">Munin</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html">Web Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html#httpd-apache2-web-server">HTTPD - Apache2 Web Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html#php5-scripting-language">PHP5 - Scripting Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html#squid-proxy-server">Squid - Proxy Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html#ruby-on-rails">Ruby on Rails</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-servers.html#apache-tomcat">Apache Tomcat</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html#mysql">MySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html#postgresql">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html">LAMP Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html#moin-moin">Moin Moin</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html#mediawiki">MediaWiki</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html#phpmyadmin">phpMyAdmin</a></li>
<li class="toctree-l1"><a class="reference internal" href="lamp-applications.html#wordpress">WordPress</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-server.html">File Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-server.html#ftp-server">FTP Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-server.html#network-file-system-nfs">Network File System (NFS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-server.html#iscsi-initiator">iSCSI Initiator</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-server.html#cups-print-server">CUPS - Print Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Email Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html#postfix">Postfix</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html#exim4">Exim4</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html#dovecot-server">Dovecot Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html#mailman">Mailman</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html#mail-filtering">Mail Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="chat.html">Chat Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="chat.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="chat.html#irc-server">IRC Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="chat.html#jabber-instant-messaging-server">Jabber Instant Messaging Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcs.html">Version Control System</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcs.html#bazaar">Bazaar</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcs.html#git">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcs.html#subversion">Subversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcs.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html">Samba</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#file-server">File Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#print-server">Print Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#securing-file-and-print-server">Securing File and Print Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#as-a-domain-controller">As a Domain Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html#active-directory-integration">Active Directory Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="backups.html">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="backups.html#shell-scripts">Shell Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="backups.html#archive-rotation">Archive Rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="backups.html#bacula">Bacula</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualization.html">Virtualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualization.html#libvirt">libvirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualization.html#cloud-images-and-vmbuilder">Cloud images and vmbuilder</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualization.html#ubuntu-cloud">Ubuntu Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtualization.html#lxc">LXC</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html#drbd">DRBD</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn.html">VPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn.html#openvpn">OpenVPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="other-apps.html">Other Useful Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="other-apps.html#pam-motd">pam_motd</a></li>
<li class="toctree-l1"><a class="reference internal" href="other-apps.html#etckeeper">etckeeper</a></li>
<li class="toctree-l1"><a class="reference internal" href="other-apps.html#byobu">Byobu</a></li>
<li class="toctree-l1"><a class="reference internal" href="other-apps.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting-bugs.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting-bugs.html#reporting-bugs-in-ubuntu-server-edition">Reporting Bugs in Ubuntu Server Edition</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dns.html"
                        title="previous chapter">Domain Name Service (DNS)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="monitoring.html"
                        title="next chapter">Monitoring</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/security.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="monitoring.html" title="Monitoring"
             >next</a></li>
        <li class="right" >
          <a href="dns.html" title="Domain Name Service (DNS)"
             >previous</a> |</li>
        <li><a href="index.html">Ubuntu Server Guide - 14.04 LTS</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Ubuntu Documentation Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>